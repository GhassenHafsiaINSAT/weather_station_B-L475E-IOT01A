/*
 * hts221.c
 *
 *  Created on: Apr 26, 2025
 *      Author: ghass
 */
#include "hts221.h"

uint8_t hts221_read_register(uint8_t reg){
	uint8_t value = 0;
	HAL_I2C_Master_Transmit(hi2c2, HTS221_SLAVE_ADDR << 1, &reg, 1, 100);
	HAL_I2C_Master_Receive(hi2c2, HTS221_SLAVE_ADDR << 1, &value, 1, 100);
	return value;
}
void hts221_write_register(uint8_t reg, uint8_t value){
	uint8_t* data[] = {reg, value};
	HAL_I2C_Master_Transmit(hi2c2, HTS221_SLAVE_ADDR << 1, data, 2, 100);
}

uint16_t hts221_read_temp_register(){
	uint8_t temp_high = hts221_read_register(TEMP_OUT_H_OFFSET);
	uint8_t temp_low = hts221_read_register(TEMP_OUT_L_OFFSET);
	return (((uint16_t)temp_high << 1 )| temp_low);
}

uint16_t hts221_read_humd_register(){
	uint8_t humd_high = hts221_read_register(HUMIDITY_OUT_H_OFFSET);
	uint8_t humd_low = hts221_read_register(HUMIDITY_OUT_L_OFFSET);
	return (((uint16_t)humd_high << 1 )| humd_low);
}

void hts221_init(){
	// normal mode, default output speed
	hts221_write_register(CTRL_REG1_OFFSET, 0x85);

	// default control2_register configuration
	hts221_write_register(CTRL_REG2_OFFSET, 0x00);

	// default control3_register configuration
	hts221_write_register(CTRL_REG3_OFFSET, 0x00);
}
